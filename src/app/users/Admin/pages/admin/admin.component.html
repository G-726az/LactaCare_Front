<div class="admin-container">
  <!-- SISTEMA DE NOTIFICACIONES -->
  <app-notification></app-notification>

  <!-- SIDEBAR DESPLEGABLE -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <button class="toggle-btn" (click)="toggleSidebar()">
        <span class="hamburger">‚ò∞</span>
      </button>
      <h2 *ngIf="!sidebarCollapsed">Admin Panel</h2>
    </div>

    <!-- PERFIL DEL ADMIN -->
    <div class="admin-profile" (click)="toggleProfileMenu()">
      <div class="profile-img">
        <img [src]="adminData.foto || 'assets/default-avatar.png'" alt="Admin" />
      </div>
      <div class="profile-info" *ngIf="!sidebarCollapsed">
        <h4>{{ adminData.nombre }}</h4>
        <span class="role-badge">{{ adminData.rol }}</span>
      </div>
      <span class="dropdown-icon" *ngIf="!sidebarCollapsed">‚ñº</span>
    </div>

    <!-- MEN√ö DESPLEGABLE DEL PERFIL -->
    <div class="profile-dropdown" *ngIf="showProfileMenu && !sidebarCollapsed">
      <div class="profile-details">
        <p><strong>Nombre:</strong> {{ adminData.nombreCompleto }}</p>
        <p><strong>Email:</strong> {{ adminData.email }}</p>
        <p><strong>Tel√©fono:</strong> {{ adminData.telefono }}</p>
        <p><strong>Rol:</strong> {{ adminData.rol }}</p>
      </div>
      <button class="btn-edit-profile" (click)="editarPerfil()">‚úèÔ∏è Editar Perfil</button>
    </div>

    <!-- NAVEGACI√ìN -->
    <nav class="sidebar-nav">
      <a
        *ngFor="let item of menuItems"
        [class.active]="seccionActiva === item.id"
        (click)="cambiarSeccion(item.id)"
        [title]="item.label"
      >
        <span class="nav-icon">{{ item.icon }}</span>
        <span class="nav-label" *ngIf="!sidebarCollapsed">{{ item.label }}</span>
      </a>
    </nav>

    <!-- BOT√ìN CERRAR SESI√ìN -->
    <button class="btn-logout" (click)="cerrarSesion()">
      <span class="nav-icon">üö™</span>
      <span *ngIf="!sidebarCollapsed">Cerrar Sesi√≥n</span>
    </button>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-content">
    <div class="content-header">
      <h1>{{ getTituloSeccion() }}</h1>
    </div>

    <!-- SECCIONES DIN√ÅMICAS -->
    <div class="content-body">
      <!-- DASHBOARD -->
      <section *ngIf="seccionActiva === 'dashboard'" class="dashboard-section">
        <div class="stats-grid">
          <div class="stat-card pink">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
              <p class="stat-label">Total Pacientes</p>
              <h3 class="stat-number">{{ pacientes.length }}</h3>
            </div>
          </div>

          <div class="stat-card pink">
            <div class="stat-icon">üë∑</div>
            <div class="stat-content">
              <p class="stat-label">Total Empleados</p>
              <h3 class="stat-number">{{ empleadosAct.length }} activos</h3>
              <span class="stat-change">{{ empleadosInact.length }} inactivos</span>
            </div>
          </div>

          <div class="stat-card purple">
            <div class="stat-icon">üè•</div>
            <div class="stat-content">
              <p class="stat-label">Lactarios Activos</p>
              <h3 class="stat-number">{{ salasLactanciaAct.length }} activos</h3>
              <span class="stat-change">{{ salasLactanciaInact.length }} inactivos</span>
            </div>
          </div>
        </div>

        <!-- GR√ÅFICA DE ACTIVIDAD -->
        <div class="row">
          <!-- =================== COLUMNA EMPLEADOS =================== -->
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                  <li class="nav-item">
                    <button
                      class="nav-link"
                      [class.active]="tabActivo === 'ACTIVOS'"
                      (click)="tabActivo = 'ACTIVOS'"
                      type="button"
                    >
                      Activos
                    </button>
                  </li>

                  <li class="nav-item">
                    <button
                      class="nav-link"
                      [class.active]="tabActivo === 'INACTIVOS'"
                      (click)="tabActivo = 'INACTIVOS'"
                      type="button"
                    >
                      Inactivos
                    </button>
                  </li>
                </ul>
              </div>

              <div class="card-body">
                <h5 class="card-title">
                  Empleados {{ tabActivo === 'ACTIVOS' ? 'Activos' : 'Inactivos' }}
                </h5>

                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Nombre</th>
                      <th>Apellido</th>
                      <th>Rol</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (emp of empleadosFiltrados; track emp.idPerEmpleado) {
                    <tr>
                      <td>{{ emp.primerNombre }}</td>
                      <td>{{ emp.primerApellido }}</td>
                      <td>{{ emp.rol.nombreRol }}</td>
                    </tr>
                    } @if (empleadosFiltrados.length === 0) {
                    <tr>
                      <td colspan="3" class="text-center text-muted">No hay registros</td>
                    </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- =================== COLUMNA IOT =================== -->
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Registro IOT</h5>

                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Sensor</th>
                      <th>Temperatura</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (alert of alertas; track alert.id) {
                    <tr>
                      <td>{{ alert.numeroIOT }}</td>
                      <td>{{ alert.temperaturaAlerta }} ¬∞C</td>
                      <td>
                        <span
                          class="rounded-pill"
                          [ngClass]="{
                            'bg-danger': alert.tipoAlerta === 'AUMENTO',
                            'bg-warning text-dark': alert.tipoAlerta === 'BAJADA',
                          }"
                        >
                          {{ alert.tipoAlerta }}
                        </span>
                      </td>
                    </tr>
                    } @if (alertas.length === 0) {
                    <tr>
                      <td colspan="3" class="text-center text-muted">No hay alertas</td>
                    </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- GESTI√ìN DE LACTARIOS -->
      <section *ngIf="seccionActiva === 'lactarios'">
        <app-lactarios></app-lactarios>
      </section>

      <!-- GESTI√ìN DE EMPLEADOS -->
      <section *ngIf="seccionActiva === 'empleados'">
        <app-empleados></app-empleados>
      </section>

      <!-- REFRIGERADORES -->
      <section *ngIf="seccionActiva === 'refrigeradores'">
        <app-refrigeradores></app-refrigeradores>
      </section>

      <!-- CHATBOT IA -->
      <section *ngIf="seccionActiva === 'chatbot'">
        <app-chatbot></app-chatbot>
      </section>

      <!-- SUGERENCIAS -->
      <section *ngIf="seccionActiva === 'sugerencias'">
        <app-sugerencias></app-sugerencias>
      </section>

      <!-- CONFIGURACI√ìN -->
      <section *ngIf="seccionActiva === 'configuracion'">
        <app-configuracion></app-configuracion>
      </section>

      <!-- SISTEMA -->
      <section *ngIf="seccionActiva === 'sistema'">
        <app-sistema></app-sistema>
      </section>
    </div>
  </main>
</div>
