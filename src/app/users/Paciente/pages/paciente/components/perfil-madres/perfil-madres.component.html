<div class="perfil-container">
  <div class="content-header">
    <h1>ğŸ‘¤ Mi Perfil</h1>
    <button class="btn-edit" (click)="toggleEditMode()" *ngIf="!editMode" [disabled]="loading">
      âœï¸ Editar Perfil
    </button>
  </div>

  <div class="content-body">
    <div class="perfil-card">
      <!-- HEADER DEL PERFIL -->
      <div class="perfil-header">
        <div class="profile-image-wrapper">
          <img
            [src]="pacienteData.imagenPerfil"
            alt="Foto de perfil"
            class="profile-image"
            (error)="pacienteData.imagenPerfil = '/assets/images/default-avatar.png'"
          />
          <button
            class="btn-change-photo"
            (click)="habilitarEdicionImagen()"
            *ngIf="editMode && !editandoImagen"
            title="Cambiar foto"
          >
            ğŸ“·
          </button>
        </div>
        <div class="profile-info">
          <h2>{{ pacienteData.nombreCompleto || 'Cargando...' }}</h2>
          <p class="rol-badge">{{ pacienteData.rol }}</p>
          <p class="edad-info" *ngIf="pacienteData.fechaNacimiento">ğŸ‚ {{ calcularEdad() }} aÃ±os</p>
        </div>
      </div>

      <!-- ğŸ”¥ NUEVO: SecciÃ³n de ediciÃ³n de imagen con link -->
      <div class="imagen-editor" *ngIf="editMode && editandoImagen">
        <div class="editor-header">
          <h3>ğŸ–¼ï¸ Editar Imagen de Perfil</h3>
        </div>
        <div class="editor-body">
          <label for="imagenLink">Ingresa el link de tu imagen:</label>
          <input
            type="url"
            id="imagenLink"
            [(ngModel)]="pacienteData.imagenPerfil"
            class="form-input"
            placeholder="https://ejemplo.com/tu-imagen.jpg"
            [class.error]="errores['imagenPerfil']"
          />
          <span class="error-message" *ngIf="errores['imagenPerfil']">
            {{ errores['imagenPerfil'] }}
          </span>
          <div class="editor-preview">
            <p><strong>Vista previa:</strong></p>
            <img
              [src]="pacienteData.imagenPerfil"
              alt="Vista previa"
              class="preview-image"
              (error)="pacienteData.imagenPerfil = '/assets/images/default-avatar.png'"
            />
          </div>
          <div class="editor-actions">
            <button class="btn-apply" (click)="aplicarLinkImagen()">âœ… Aplicar</button>
            <button class="btn-cancel-img" (click)="cancelarEdicionImagen()">âŒ Cancelar</button>
          </div>
        </div>
      </div>

      <!-- BODY DEL PERFIL -->
      <div class="perfil-body">
        <!-- CÃ©dula -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸªª</span>
            CÃ©dula:
          </label>
          <input
            type="text"
            [(ngModel)]="pacienteData.cedula"
            [disabled]="!editMode"
            class="form-input"
            [class.error]="errores['cedula']"
            maxlength="10"
          />
          <span class="error-message" *ngIf="errores['cedula']">{{ errores['cedula'] }}</span>
        </div>

        <!-- Primer Nombre -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ‘¤</span>
            Primer Nombre:
          </label>
          <input
            type="text"
            [(ngModel)]="pacienteData.primerNombre"
            [disabled]="!editMode"
            class="form-input"
            [class.error]="errores['primerNombre']"
          />
          <span class="error-message" *ngIf="errores['primerNombre']">{{
            errores['primerNombre']
          }}</span>
        </div>

        <!-- Segundo Nombre -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ‘¤</span>
            Segundo Nombre (opcional):
          </label>
          <input
            type="text"
            [(ngModel)]="pacienteData.segundoNombre"
            [disabled]="!editMode"
            class="form-input"
          />
        </div>

        <!-- Primer Apellido -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ‘¤</span>
            Primer Apellido:
          </label>
          <input
            type="text"
            [(ngModel)]="pacienteData.primerApellido"
            [disabled]="!editMode"
            class="form-input"
            [class.error]="errores['primerApellido']"
          />
          <span class="error-message" *ngIf="errores['primerApellido']">{{
            errores['primerApellido']
          }}</span>
        </div>

        <!-- Segundo Apellido -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ‘¤</span>
            Segundo Apellido (opcional):
          </label>
          <input
            type="text"
            [(ngModel)]="pacienteData.segundoApellido"
            [disabled]="!editMode"
            class="form-input"
          />
        </div>

        <!-- Email -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ“§</span>
            Email:
          </label>
          <input
            type="email"
            [(ngModel)]="pacienteData.correo"
            [disabled]="!editMode"
            class="form-input"
            [class.error]="errores['correo']"
          />
          <span class="error-message" *ngIf="errores['correo']">{{ errores['correo'] }}</span>
        </div>

        <!-- TelÃ©fono -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ“±</span>
            TelÃ©fono:
          </label>
          <input
            type="tel"
            [(ngModel)]="pacienteData.telefono"
            [disabled]="!editMode"
            class="form-input"
            [class.error]="errores['telefono']"
            maxlength="10"
          />
          <span class="error-message" *ngIf="errores['telefono']">{{ errores['telefono'] }}</span>
        </div>

        <!-- Fecha de Nacimiento -->
        <div class="info-row">
          <label>
            <span class="label-icon">ğŸ‚</span>
            Fecha de Nacimiento:
          </label>
          <input
            type="date"
            [(ngModel)]="pacienteData.fechaNacimiento"
            [disabled]="!editMode"
            class="form-input"
          />
        </div>

        <!-- Discapacidad -->
        <div class="info-row">
          <label>
            <span class="label-icon">â™¿</span>
            Â¿Tiene alguna discapacidad?
          </label>
          <input
            type="checkbox"
            [(ngModel)]="pacienteData.discapacidad"
            [disabled]="!editMode"
            class="form-checkbox"
          />
        </div>
      </div>

      <!-- FOOTER DEL PERFIL -->
      <div class="perfil-footer" *ngIf="editMode">
        <button class="btn-save" (click)="guardarCambios()" [disabled]="loading">
          ğŸ’¾ Guardar Cambios
        </button>
        <button class="btn-cancel" (click)="cancelarEdicion()" [disabled]="loading">
          âœ– Cancelar
        </button>
      </div>

      <!-- INFORMACIÃ“N ADICIONAL (solo vista) -->
      <div class="info-adicional" *ngIf="!editMode">
        <div class="info-card">
          <h4>ğŸ“Š EstadÃ­sticas</h4>
          <p>â€¢ Extracciones registradas: <strong>45</strong></p>
          <p>â€¢ Reservas realizadas: <strong>12</strong></p>
          <p>â€¢ Ãšltima visita: <strong>Hoy</strong></p>
        </div>
      </div>
    </div>
  </div>
</div>
