<!-- Indicador de perfil seleccionado -->
<div *ngIf="mostrarIndicadorPerfil && perfilSeleccionado" class="perfil-indicator">
  <i
    class="fas"
    [ngClass]="{
      'fa-user-shield': perfilSeleccionado === 'ADMINISTRADOR',
      'fa-user-md': perfilSeleccionado === 'MEDICO',
      'fa-user': perfilSeleccionado === 'PACIENTE'
    }"
  ></i>
  <span>Perfil: {{ perfilSeleccionado }}</span>
</div>

<!-- Mostrar solo el formulario de login si NO est√° autenticado -->
<div *ngIf="!isAuthenticated">
  <!-- LOGIN CONTAINER -->
  <div id="login" class="auth-container" [class.active]="activeTab === 'login'">
    <!-- Image Carousel -->
    <div class="carousel-panel">
      <div class="carousel-container">
        <div
          *ngFor="let slide of carouselSlides['login']; let i = index"
          class="carousel-slide"
          [class.active]="currentSlideIndex['login'] === i"
        >
          <img [src]="slide.image" [alt]="slide.title" class="carousel-image" />
          <div class="carousel-content">
            <h2 class="carousel-title">{{ slide.title }}</h2>
            <p class="carousel-description">{{ slide.description }}</p>
          </div>
        </div>

        <button class="carousel-nav carousel-prev" (click)="prevSlide('login')">‚Äπ</button>
        <button class="carousel-nav carousel-next" (click)="nextSlide('login')">‚Ä∫</button>

        <div class="carousel-dots">
          <div
            *ngFor="let slide of carouselSlides['login']; let i = index"
            class="carousel-dot"
            [class.active]="currentSlideIndex['login'] === i"
            (click)="goToSlide('login', i)"
          ></div>
        </div>
      </div>
    </div>

    <!-- Login Form -->
    <div class="form-panel">
      <!-- Navigation Tabs -->
      <div class="auth-tabs">
        <button
          class="auth-tab"
          [class.active]="activeTab === 'login'"
          (click)="switchTab('login')"
        >
          Iniciar Sesi√≥n
        </button>
        <button
          *ngIf="mostrarRegistro()"
          class="auth-tab"
          [class.active]="activeTab === 'register'"
          (click)="switchTab('register')"
        >
          Registrarse
        </button>
        <button
          class="auth-tab"
          [class.active]="activeTab === 'recover'"
          (click)="switchTab('recover')"
        >
          Recuperar Contrase√±a
        </button>
      </div>

      <div class="brand-header">
        <div class="brand-logo">
          <i class="fas fa-heartbeat brand-icon"></i>
          LactaCare
        </div>
        <div class="brand-tagline">Sistema M√©dico Especializado en Lactancia</div>
      </div>

      <div class="form-container">
        <h2 class="form-title">Iniciar sesi√≥n</h2>
        <p class="form-subtitle">Accede a tu cuenta para gestionar pacientes y consultas</p>

        <!-- Reemplazar el campo de c√©dula por correo en el formulario de login -->

        <form (ngSubmit)="onLoginSubmit()" #loginForm="ngForm">
          <!-- ‚úÖ CAMBIO: Campo de correo en lugar de c√©dula -->
          <div class="form-group">
            <label class="form-label">Correo Electr√≥nico *</label>
            <input
              type="email"
              class="form-input"
              placeholder="ejemplo@correo.com"
              [(ngModel)]="loginData.correo"
              name="correo"
              required
              email
              autocomplete="email"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Contrase√±a *</label>
            <input
              type="password"
              class="form-input"
              placeholder="Ingresa tu contrase√±a"
              [(ngModel)]="loginData.password"
              name="password"
              required
              autocomplete="current-password"
            />
          </div>

          <button type="submit" class="form-button" [disabled]="!loginForm.form.valid">
            Iniciar Sesi√≥n
          </button>

          <!-- Bot√≥n de Google (sin cambios) -->
          <button class="button" type="button">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              preserveAspectRatio="xMidYMid"
              viewBox="0 0 256 262"
              class="svg"
            >
              <path
                fill="#4285F4"
                d="M255.878 133.451c0-10.734-.871-18.567-2.756-26.69H130.55v48.448h71.947c-1.45 12.04-9.283 30.172-26.69 42.356l-.244 1.622 38.755 30.023 2.685.268c24.659-22.774 38.875-56.282 38.875-96.027"
                class="blue"
              ></path>
              <path
                fill="#34A853"
                d="M130.55 261.1c35.248 0 64.839-11.605 86.453-31.622l-41.196-31.913c-11.024 7.688-25.82 13.055-45.257 13.055-34.523 0-63.824-22.773-74.269-54.25l-1.531.13-40.298 31.187-.527 1.465C35.393 231.798 79.49 261.1 130.55 261.1"
                class="green"
              ></path>
              <path
                fill="#FBBC05"
                d="M56.281 156.37c-2.756-8.123-4.351-16.827-4.351-25.82 0-8.994 1.595-17.697 4.206-25.82l-.073-1.73L15.26 71.312l-1.335.635C5.077 89.644 0 109.517 0 130.55s5.077 40.905 13.925 58.602l42.356-32.782"
                class="yellow"
              ></path>
              <path
                fill="#EB4335"
                d="M130.55 50.479c24.514 0 41.05 10.589 50.479 19.438l36.844-35.974C195.245 12.91 165.798 0 130.55 0 79.49 0 35.393 29.301 13.925 71.947l42.211 32.783c10.59-31.477 39.891-54.251 74.414-54.251"
                class="red"
              ></path>
            </svg>
            <span class="text">Continue with Google</span>
          </button>

          <!-- Botones de prueba actualizados -->
          <div class="test-credentials">
            <p class="test-title">üí° Datos para pruebas:</p>
            <div class="test-buttons">
              <button type="button" class="test-btn admin" (click)="fillAdminCredentials()">
                üëë Administrador
              </button>
              <button type="button" class="test-btn doctor" (click)="fillDoctorCredentials()">
                üë®‚Äç‚öïÔ∏è M√©dico
              </button>
              <button type="button" class="test-btn paciente" (click)="fillPacienteCredentials()">
                üë∂ Paciente
              </button>
            </div>
          </div>

          <div class="form-links">
            <a href="#" class="form-link" (click)="switchTab('recover'); $event.preventDefault()">
              ¬øOlvidaste tu contrase√±a?
            </a>
          </div>
        </form>

        <div class="form-footer">
          <div class="powered-by">Powered by Possum Inc.</div>
          <div class="contact-info">593 0999999999 | 02-222222</div>
        </div>
      </div>
    </div>
  </div>

  <!-- REGISTER CONTAINER (Solo visible para PACIENTES) -->
  <div
    id="register"
    class="auth-container"
    [class.active]="activeTab === 'register'"
    *ngIf="mostrarRegistro()"
  >
    <!-- Image Carousel -->
    <div class="carousel-panel">
      <div class="carousel-container">
        <div
          *ngFor="let slide of carouselSlides['register']; let i = index"
          class="carousel-slide"
          [class.active]="currentSlideIndex['register'] === i"
        >
          <img [src]="slide.image" [alt]="slide.title" class="carousel-image" />
          <div class="carousel-content">
            <h2 class="carousel-title">{{ slide.title }}</h2>
            <p class="carousel-description">{{ slide.description }}</p>
          </div>
        </div>

        <button class="carousel-nav carousel-prev" (click)="prevSlide('register')">‚Äπ</button>
        <button class="carousel-nav carousel-next" (click)="nextSlide('register')">‚Ä∫</button>

        <div class="carousel-dots">
          <div
            *ngFor="let slide of carouselSlides['register']; let i = index"
            class="carousel-dot"
            [class.active]="currentSlideIndex['register'] === i"
            (click)="goToSlide('register', i)"
          ></div>
        </div>
      </div>
    </div>

    <!-- Register Form -->
    <div class="form-panel">
      <!-- Navigation Tabs -->
      <div class="auth-tabs">
        <button
          class="auth-tab"
          [class.active]="activeTab === 'login'"
          (click)="switchTab('login')"
        >
          Iniciar Sesi√≥n
        </button>
        <button
          class="auth-tab"
          [class.active]="activeTab === 'register'"
          (click)="switchTab('register')"
        >
          Registrarse
        </button>
        <button
          class="auth-tab"
          [class.active]="activeTab === 'recover'"
          (click)="switchTab('recover')"
        >
          Recuperar Contrase√±a
        </button>
      </div>

      <div class="brand-header">
        <div class="brand-logo">
          <i class="fas fa-heartbeat brand-icon"></i>
          LactaCare
        </div>
        <div class="brand-tagline">Registro de Pacientes</div>
      </div>

      <div class="form-container">
        <h2 class="form-title">Crear cuenta de paciente</h2>
        <p class="form-subtitle">Reg√≠strate para acceder al sistema m√©dico</p>

        <form (ngSubmit)="onRegisterSubmit()" #registerForm="ngForm">
          <div class="form-group">
            <label class="form-label">C√©dula *</label>
            <input
              type="text"
              class="form-input"
              placeholder="N√∫mero de c√©dula"
              [(ngModel)]="registerData.cedula"
              name="cedula"
              required
              maxlength="10"
            />
          </div>

          <div class="row-2">
            <div class="form-group">
              <label class="form-label">Primer Nombre *</label>
              <input
                type="text"
                class="form-input"
                placeholder="Primer nombre"
                [(ngModel)]="registerData.primer_nombre"
                name="primer_nombre"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label">Segundo Nombre</label>
              <input
                type="text"
                class="form-input"
                placeholder="Segundo nombre (opcional)"
                [(ngModel)]="registerData.segundo_nombre"
                name="segundo_nombre"
              />
            </div>
          </div>

          <div class="row-2">
            <div class="form-group">
              <label class="form-label">Primer Apellido *</label>
              <input
                type="text"
                class="form-input"
                placeholder="Primer apellido"
                [(ngModel)]="registerData.primer_apellido"
                name="primer_apellido"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label">Segundo Apellido</label>
              <input
                type="text"
                class="form-input"
                placeholder="Segundo apellido (opcional)"
                [(ngModel)]="registerData.segundo_apellido"
                name="segundo_apellido"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Correo Electr√≥nico</label>
            <input
              type="email"
              class="form-input"
              placeholder="ejemplo@correo.com"
              [(ngModel)]="registerData.correo"
              name="correo"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Tel√©fono</label>
            <input
              type="tel"
              class="form-input"
              placeholder="0999999999"
              [(ngModel)]="registerData.telefono"
              name="telefono"
              maxlength="10"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Fecha de Nacimiento</label>
            <input
              type="date"
              class="form-input"
              [(ngModel)]="registerData.fecha_nacimiento"
              name="fecha_nacimiento"
            />
          </div>

          <div class="form-group">
            <div class="checkbox-group">
              <input
                type="checkbox"
                id="discapacidad"
                [(ngModel)]="registerData.discapacidad"
                name="discapacidad"
              />
              <label for="discapacidad" class="checkbox-label">
                ¬øPresenta alguna discapacidad?
              </label>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Contrase√±a *</label>
            <input
              type="password"
              class="form-input"
              placeholder="Crea una contrase√±a segura"
              [(ngModel)]="registerData.password"
              name="password"
              required
            />
            <div class="password-strength">
              <div
                class="strength-bar"
                [style.width]="getPasswordStrength(registerData.password).width"
                [class]="getPasswordStrength(registerData.password).class"
              ></div>
            </div>
            <div class="strength-text">{{ getPasswordStrength(registerData.password).text }}</div>
          </div>

          <div class="form-group">
            <label class="form-label">Confirmar Contrase√±a *</label>
            <input
              type="password"
              class="form-input"
              placeholder="Repite tu contrase√±a"
              [(ngModel)]="registerData.confirmPassword"
              name="confirmPassword"
              required
            />
          </div>

          <div class="terms-checkbox">
            <input type="checkbox" id="terms" name="terms" required #terms="ngModel" ngModel />
            <label for="terms" class="terms-text">
              Acepto los <a href="#" class="terms-link">T√©rminos de Servicio</a> y
              <a href="#" class="terms-link">Pol√≠tica de Privacidad</a> del Sistema M√©dico LactaCare
            </label>
          </div>

          <button type="submit" class="form-button" [disabled]="!registerForm.form.valid">
            Registrar Paciente
          </button>

          <div class="form-links">
            <a href="#" class="form-link" (click)="switchTab('login'); $event.preventDefault()">
              ¬øYa tienes una cuenta? Inicia sesi√≥n
            </a>
          </div>
        </form>

        <div class="form-footer">
          <div class="powered-by">Powered by Possum Inc.</div>
          <div class="contact-info">593 0999999999 | 02-222222</div>
        </div>
      </div>
    </div>
  </div>

  <!-- RECOVER PASSWORD CONTAINER -->
  <div id="recover" class="auth-container" [class.active]="activeTab === 'recover'">
    <div class="carousel-panel">
      <div class="carousel-container">
        <div
          *ngFor="let slide of carouselSlides['recover']; let i = index"
          class="carousel-slide"
          [class.active]="currentSlideIndex['recover'] === i"
        >
          <img [src]="slide.image" [alt]="slide.title || 'Imagen01'" class="carousel-image" />
          <div class="carousel-content">
            <h2 class="carousel-title">{{ slide.title }}</h2>
            <p class="carousel-description">{{ slide.description }}</p>
          </div>
        </div>

        <button class="carousel-nav carousel-prev" (click)="prevSlide('recover')">‚Äπ</button>
        <button class="carousel-nav carousel-next" (click)="nextSlide('recover')">‚Ä∫</button>

        <div class="carousel-dots">
          <div
            *ngFor="let slide of carouselSlides['recover']; let i = index"
            class="carousel-dot"
            [class.active]="currentSlideIndex['recover'] === i"
            (click)="goToSlide('recover', i)"
          ></div>
        </div>
      </div>
    </div>

    <!-- Recover Password Form -->
    <div class="form-panel">
      <!-- Navigation Tabs -->
      <div class="auth-tabs">
        <button
          class="auth-tab"
          [class.active]="activeTab === 'login'"
          (click)="switchTab('login')"
        >
          Iniciar Sesi√≥n
        </button>
        <button
          *ngIf="mostrarRegistro()"
          class="auth-tab"
          [class.active]="activeTab === 'register'"
          (click)="switchTab('register')"
        >
          Registrarse
        </button>
        <button
          class="auth-tab"
          [class.active]="activeTab === 'recover'"
          (click)="switchTab('recover')"
        >
          Recuperar Contrase√±a
        </button>
      </div>

      <div class="brand-header">
        <div class="brand-logo">
          <i class="fas fa-heartbeat brand-icon"></i>
          LactaCare
        </div>
        <div class="brand-tagline">Recuperaci√≥n de cuenta segura</div>
      </div>

      <div class="form-container">
        <!-- Step 1: Request Recovery -->
        <div *ngIf="recoveryStep === 1" id="recoverStep1">
          <h2 class="form-title">Recuperar contrase√±a</h2>
          <p class="form-subtitle">
            Ingresa tu correo electr√≥nico para recibir un c√≥digo de recuperaci√≥n
          </p>

          <form (ngSubmit)="onRecoveryStep1(); $event.preventDefault()">
            <div class="form-group">
              <label class="form-label">Correo electr√≥nico</label>
              <input
                type="email"
                class="form-input"
                placeholder="Ingresa tu correo registrado"
                [(ngModel)]="recoveryData.correo"
                name="correo"
                required
              />
            </div>

            <button type="submit" class="form-button">Enviar C√≥digo de Recuperaci√≥n</button>

            <div class="form-links">
              <a href="#" class="form-link" (click)="switchTab('login'); $event.preventDefault()">
                Volver a Iniciar Sesi√≥n
              </a>
            </div>
          </form>
        </div>

        <!-- Step 2: Enter Code -->
        <div *ngIf="recoveryStep === 2" id="recoverStep2">
          <h2 class="form-title">Verificar c√≥digo</h2>
          <p class="form-subtitle">Ingresa el c√≥digo de 6 d√≠gitos que enviamos a tu correo</p>

          <form (ngSubmit)="onRecoveryStep2(); $event.preventDefault()">
            <div class="form-group">
              <label class="form-label">C√≥digo de verificaci√≥n</label>
              <input
                type="text"
                class="form-input"
                placeholder="XXXXXX"
                maxlength="6"
                [(ngModel)]="recoveryData.code"
                name="code"
                required
              />
            </div>

            <div class="recovery-code">C√≥digo: {{ recoveryCode }}</div>

            <button type="button" class="form-button secondary-button" (click)="onRecoveryStep1()">
              Reenviar c√≥digo
            </button>
            <button type="submit" class="form-button">Verificar C√≥digo</button>
          </form>
        </div>

        <!-- Step 3: Reset Password -->
        <div *ngIf="recoveryStep === 3" id="recoverStep3">
          <h2 class="form-title">Nueva contrase√±a</h2>
          <p class="form-subtitle">Crea una nueva contrase√±a para tu cuenta</p>

          <form (ngSubmit)="onRecoveryStep3(); $event.preventDefault()">
            <div class="form-group">
              <label class="form-label">Nueva contrase√±a</label>
              <input
                type="password"
                class="form-input"
                placeholder="Crea una nueva contrase√±a"
                [(ngModel)]="recoveryData.newPassword"
                name="newPassword"
                required
              />
              <div class="password-strength">
                <div
                  class="strength-bar"
                  [style.width]="getPasswordStrength(recoveryData.newPassword).width"
                  [class]="getPasswordStrength(recoveryData.newPassword).class"
                ></div>
              </div>
              <div class="strength-text">
                {{ getPasswordStrength(recoveryData.newPassword).text }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Confirmar nueva contrase√±a</label>
              <input
                type="password"
                class="form-input"
                placeholder="Repite la nueva contrase√±a"
                [(ngModel)]="recoveryData.confirmNewPassword"
                name="confirmNewPassword"
                required
              />
            </div>

            <button type="submit" class="form-button">Restablecer Contrase√±a</button>
          </form>
        </div>

        <!-- Success Message -->
<div *ngIf="recoveryStep === 4" class="success-message">
  <i class="fas fa-check-circle success-icon"></i>
  <h3 class="success-title">¬°Contrase√±a restablecida!</h3>
  <p class="success-text">Tu contrase√±a ha sido cambiada exitosamente.</p>
  <button type="button" class="form-button success-button" (click)="switchTab('login')">
    Ir a Iniciar Sesi√≥n
  </button>
</div>

        <div class="form-footer">
          <div class="powered-by">Powered by Possum Inc.</div>
          <div class="contact-info">593 0999999999 | 02-222222</div>
        </div>
      </div>
    </div>
  </div>
</div>
